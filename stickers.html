<!DOCTYPE html>
<html lang="zh-CN">

<head>
        <meta charset="UTF-8">
        <script>
                (function () {
                        try {
                                // Use synchronous localStorage to get theme settings, much faster than database
                                const themeMode = localStorage.getItem('xphone-theme-mode');
                                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

                                if (themeMode === 'dark' || (themeMode === 'auto' && systemPrefersDark)) {
                                        document.documentElement.classList.add('dark');
                                }
                                // If 'light' or not set in localStorage, do nothing, keep the default
                        } catch (e) {
                                // Catch exceptions in case localStorage is disabled
                        }
                })();
        </script>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">

        <link rel="manifest" href="./manifest.json">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="Xphone">
        <meta name="theme-color" content="#3b82f6" />
        <link rel="apple-touch-icon" href="./icons/icon-192x192.png">

        <title>我的表情</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
        <link rel="stylesheet" href="sharedStyles.css">
        <script type="module" src="applyGlobalStyles.js" defer></script>

        <style>
                /* Disable default text selection and image dragging */
                body,
                #sticker-grid-container {
                        user-select: none;
                        -webkit-user-select: none;
                }

                .sticker-grid-item img {
                        pointer-events: none;
                }

                .sticker-grid-item {
                        position: relative;
                        aspect-ratio: 1 / 1;
                        background-color: #f3f4f6;
                        border-radius: 0.5rem;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        overflow: hidden;
                        transition: transform 0.1s, box-shadow 0.1s;
                }

                .sticker-grid-item.drag-selected {
                        transform: scale(0.95);
                        box-shadow: 0 0 0 3px var(--theme-color);
                }

                .edit-mode .edit-mode-item {
                        display: flex;
                }

                #selection-rectangle {
                        position: absolute;
                        border: 1px dashed var(--theme-color);
                        background-color: rgba(59, 130, 246, 0.2);
                        z-index: 100;
                        pointer-events: none;
                        /* Important */
                }

                /* Edit mode footer */
                #edit-mode-footer {
                        position: fixed;
                        bottom: 0;
                        left: 0;
                        right: 0;
                        background-color: rgba(255, 255, 255, 0.8);
                        backdrop-filter: blur(12px);
                        -webkit-backdrop-filter: blur(12px);
                        border-top: 1px solid var(--border-color-light);
                        padding: 1rem;
                        padding-bottom: calc(1rem + env(safe-area-inset-bottom));
                        z-index: 20;
                        transform: translateY(100%);
                        transition: transform 0.3s ease-in-out;
                }

                html.dark #edit-mode-footer {
                        background-color: rgba(28, 28, 30, 0.8);
                        border-top-color: var(--border-color-dark);
                }

                #edit-mode-footer.visible {
                        transform: translateY(0);
                }
        </style>
</head>

<body class="bg-gray-100">
        <input type="file" id="local-sticker-input" class="hidden" accept="image/*">

        <div class="w-full h-full mx-auto flex flex-col">
                <header class="app-header">
                        <div class="flex items-center justify-between relative">
                                <button id="header-left-btn" class="header-btn p-1.5 -ml-1.5 rounded-full">
                                </button>

                                <h1 id="default-title" class="text-base font-semibold text-gray-800">我的表情</h1>

                                <div class="relative">
                                        <button id="more-options-btn" class="header-btn p-1.5 -mr-1.5 rounded-full">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                        fill="currentColor" viewBox="0 0 16 16">
                                                        <path
                                                                d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" />
                                                </svg>
                                        </button>
                                        <div id="more-options-menu" class="dropdown-menu hidden">
                                                <a href="#" id="bulk-add-btn" class="dropdown-menu-item">批量导入</a>
                                                <a href="#" id="export-all-btn" class="dropdown-menu-item">全部导出</a>
                                                <a href="#" id="edit-stickers-btn" class="dropdown-menu-item">编辑</a>
                                        </div>
                                </div>
                        </div>
                </header>

                <main class="flex-grow main-content overflow-y-auto">
                        <div id="sticker-grid-container"
                                class="p-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-4 content-start">
                        </div>
                </main>
        </div>

        <footer id="edit-mode-footer" class="hidden">
                <div class="flex justify-between items-center">
                        <button id="delete-selected-btn" class="text-red-500 font-semibold disabled:text-gray-400"
                                disabled>删除 (0)</button>
                        <button id="move-top-btn" class="font-semibold disabled:text-gray-400"
                                style="color: var(--theme-color);" disabled>移到最前</button>
                </div>
        </footer>

        <script type="module" src="./stickers.js" defer></script>
</body>

</html>